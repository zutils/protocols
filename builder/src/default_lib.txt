extern crate protobuf;
extern crate serde_json;
extern crate serde;
#[macro_use] extern crate serde_derive;
extern crate failure;

pub mod __LIB_FILE_BASE_NAME__;
use __LIB_FILE_BASE_NAME__::__STRUCTURE_NAME__ as TargetStructure;
use failure::Error;

#[no_mangle]
pub extern fn get_name() -> String {
    return "__STRUCTURE_NAME__".to_string();
}

#[no_mangle]
pub extern fn handle(data: &[u8]) -> Result<(), Error> {
    let string: String = data.iter().map(|u: &u8| *u as char).collect();
    println!("Handling: {:?}", data);
    let structure: TargetStructure = serde_json::from_str(&string)?;
    println!("Received message: {:?}", structure);
    Ok(())
}

#[no_mangle]
pub extern fn get_default_message() -> Result<String, Error> {
    let structure = TargetStructure::new();
    Ok(serde_json::to_string(&structure)?)
}

#[no_mangle]
pub extern fn get_hash() -> String{
    return "__HASHCODE__".to_string();
}
